namespace: library

backend:
  name: rails-backend
  image: neighborly-backend:latest
  port: 80
  replicas: 1
  # PVC for SQLite file
  storage:
    size: 1Gi
    mountPath: /rails/storage
    # Rails will use this file via DATABASE_URL
    databaseUrl: sqlite3:/rails/storage/production.sqlite3
  # Avoid flapping probes on slow cold start
  startupProbe:
    failureThreshold: 30
    periodSeconds: 5
  resources:
    requests:
      cpu: 100m
      memory: 256Mi
    limits:
      cpu: 500m
      memory: 512Mi
  env:
    RAILS_ENV: production
    LOG_LEVEL: info
    RAILS_LOG_TO_STDOUT: "true"
    PORT: "80"
  secret:
    # Provide via --set-string backend.secret.SECRET_KEY_BASE=...
    SECRET_KEY_BASE: ""

frontend:
  name: frontend
  image: nginx:1.27
  port: 80
  replicas: 2
  static:
    enabled: true
  pdb:
    enabled: true
    minAvailable: 1
  resources:
    requests:
      cpu: 50m
      memory: 64Mi
    limits:
      cpu: 200m
      memory: 128Mi
  autoscaling:
    enabled: true
    minReplicas: 1
    maxReplicas: 5
    targetCPUUtilizationPercentage: 50

ingress:
  enabled: true
  className: nginx
  host: library.local
  catchAll: true
  sslRedirect: false

networkPolicy:
  enabled: true
  # Minikube ingress addon uses namespace: ingress-nginx
  ingressNamespaceLabelKey: kubernetes.io/metadata.name
  ingressNamespaceLabelValue: ingress-nginx
